{"version":3,"sources":["../../../../src/app-router/server/auth.ts"],"sourcesContent":["import type { SignedInAuthObject, SignedOutAuthObject } from '@clerk/backend';\nimport type {\n  CheckAuthorizationParamsWithCustomPermissions,\n  CheckAuthorizationWithCustomPermissions,\n} from '@clerk/types';\nimport { notFound, redirect } from 'next/navigation';\n\nimport { authAuthHeaderMissing } from '../../server/errors';\nimport { buildClerkProps, createGetAuth } from '../../server/getAuth';\nimport type { AuthObjectWithDeprecatedResources } from '../../server/types';\nimport { buildRequestLike } from './utils';\n\ntype AuthSignedIn = AuthObjectWithDeprecatedResources<\n  SignedInAuthObject & {\n    /**\n     * @experimental\n     * This function is experimental as it throws a Nextjs notFound error if user is not authenticated or authorized.\n     * In the future we would investigate a way to throw a more appropriate error that clearly describes the not authorized of authenticated status.\n     */\n    protect: {\n      (\n        params?:\n          | CheckAuthorizationParamsWithCustomPermissions\n          | ((has: CheckAuthorizationWithCustomPermissions) => boolean),\n        options?: { redirectUrl: string },\n      ): AuthObjectWithDeprecatedResources<SignedInAuthObject>;\n\n      (params?: { redirectUrl: string }): AuthObjectWithDeprecatedResources<SignedInAuthObject>;\n    };\n  }\n>;\n\ntype ProtectGeneric = {\n  protect: (params?: unknown, options?: unknown) => AuthObjectWithDeprecatedResources<SignedInAuthObject>;\n};\n\ntype AuthSignedOut = AuthObjectWithDeprecatedResources<\n  SignedOutAuthObject & {\n    /**\n     * @experimental\n     * This function is experimental as it throws a Nextjs notFound error if user is not authenticated or authorized.\n     * In the future we would investigate a way to throw a more appropriate error that clearly describes the not authorized of authenticated status.\n     */\n    protect: never;\n  }\n>;\n\nexport const auth = () => {\n  const authObject = createGetAuth({\n    debugLoggerName: 'auth()',\n    noAuthStatusMessage: authAuthHeaderMissing(),\n  })(buildRequestLike());\n\n  (authObject as unknown as ProtectGeneric).protect = (params: any, options: any) => {\n    const paramsOrFunction = params?.redirectUrl\n      ? undefined\n      : (params as\n          | CheckAuthorizationParamsWithCustomPermissions\n          | ((has: CheckAuthorizationWithCustomPermissions) => boolean));\n    const redirectUrl = (params?.redirectUrl || options?.redirectUrl) as string | undefined;\n\n    const handleUnauthorized = (): never => {\n      if (redirectUrl) {\n        redirect(redirectUrl);\n      }\n      notFound();\n    };\n\n    /**\n     * User is not authenticated\n     */\n    if (!authObject.userId) {\n      return handleUnauthorized();\n    }\n\n    /**\n     * User is authenticated\n     */\n    if (!paramsOrFunction) {\n      return { ...authObject };\n    }\n\n    /**\n     * if a function is passed and returns false then throw not found\n     */\n    if (typeof paramsOrFunction === 'function') {\n      if (paramsOrFunction(authObject.has)) {\n        return { ...authObject };\n      }\n      return handleUnauthorized();\n    }\n\n    /**\n     * Checking if user is authorized when permission or role is passed\n     */\n    if (authObject.has(paramsOrFunction)) {\n      return { ...authObject };\n    }\n\n    return handleUnauthorized();\n  };\n\n  return authObject as AuthSignedIn | AuthSignedOut;\n};\n\nexport const initialState = () => {\n  return buildClerkProps(buildRequestLike());\n};\n"],"mappings":"AAKA,SAAS,UAAU,gBAAgB;AAEnC,SAAS,6BAA6B;AACtC,SAAS,iBAAiB,qBAAqB;AAE/C,SAAS,wBAAwB;AAqC1B,MAAM,OAAO,MAAM;AACxB,QAAM,aAAa,cAAc;AAAA,IAC/B,iBAAiB;AAAA,IACjB,qBAAqB,sBAAsB;AAAA,EAC7C,CAAC,EAAE,iBAAiB,CAAC;AAErB,EAAC,WAAyC,UAAU,CAAC,QAAa,YAAiB;AACjF,UAAM,mBAAmB,QAAQ,cAC7B,SACC;AAGL,UAAM,cAAe,QAAQ,eAAe,SAAS;AAErD,UAAM,qBAAqB,MAAa;AACtC,UAAI,aAAa;AACf,iBAAS,WAAW;AAAA,MACtB;AACA,eAAS;AAAA,IACX;AAKA,QAAI,CAAC,WAAW,QAAQ;AACtB,aAAO,mBAAmB;AAAA,IAC5B;AAKA,QAAI,CAAC,kBAAkB;AACrB,aAAO,EAAE,GAAG,WAAW;AAAA,IACzB;AAKA,QAAI,OAAO,qBAAqB,YAAY;AAC1C,UAAI,iBAAiB,WAAW,GAAG,GAAG;AACpC,eAAO,EAAE,GAAG,WAAW;AAAA,MACzB;AACA,aAAO,mBAAmB;AAAA,IAC5B;AAKA,QAAI,WAAW,IAAI,gBAAgB,GAAG;AACpC,aAAO,EAAE,GAAG,WAAW;AAAA,IACzB;AAEA,WAAO,mBAAmB;AAAA,EAC5B;AAEA,SAAO;AACT;AAEO,MAAM,eAAe,MAAM;AAChC,SAAO,gBAAgB,iBAAiB,CAAC;AAC3C;","names":[]}